module.exports=function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){e.exports=require("react")},function(e,n){var t=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};!function(e){var n={};e.cmslink=n;n.createLink=function(o,r){var i=o.url,c=new WebSocket(i),u=function(){try{var e=localStorage.getItem("__nodes");if(e&&e.length)return JSON.parse(e)}catch(e){return console.log("load error"),{}}}()||{},a={},s=function(e){"function"==typeof r&&r(e)},l=function(e,n){var t=a[e];t&&t.forEach(function(e){e.stopped||e.callback(n)})},f=!1,p=void 0,d=500,h=function(){console.warn("requesting reconnect"),s({connected:f=!1,reconnecting:!0}),p&&clearTimeout(p),p=setTimeout(function(){c=null,c=new WebSocket(i),b()},d+=500)},y=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;s(t({},e,{connected:f})),setTimeout(function(){s({connected:f})},n)},b=function(){s({connecting:!0,connected:f}),c.onopen=function(e){d=500,s({connected:f=!0}),console.log("sending token",O),c.send("##"+O+"##"),c.send("?root"),g()},c.onerror=h,c.onclose=h,c.onmessage=function(e){var n;y({data:!0}),function e(n){var t=n.id,o=n.children;t&&(u[t]=n,l(t,n)),o&&o.map(function(n){return e(n)})}(JSON.parse(e.data)),n=u,localStorage.setItem("__nodes",JSON.stringify(n))}},m=[],g=function e(){if(m.length&&f){var n=m.shift();y({sending:!0}),c.send(n),e()}},v=function(e){m.push(e),g()},k={fakeNode:function(e){console.log("render temp node",e),l(e.id,t({},e,{__fake:!0}))},send:v,getById:function(e){v("?"+e)},listenTo:function(e,n){var t={id:e,stopped:!1,stop:function(){t.stopped=!0},resume:function(){t.stopped=!1},remove:function(){var n=a[e].indexOf(t);a[e].splice(n,1)},callback:n};return a[e]?a[e].push(t):a[e]=[t],u[e]?t.stopped||n(u[e]):v("?"+e),t}},O=n.getToken().token;return n.onAuthenticationChanged(function(e){e&&e.token&&(O=e.token),v("!!"+O+"!!")}),b(),e.currentLink=k,k},n.getCurrentLink=function(){return e.currentLink};var o=[],r={},i=localStorage.getItem("_cmsState");i&&i.length&&(r=JSON.parse(i)),n.sessionChanged=function(e){var n={stopped:!1,stop:function(){n.stopped=!0},resume:function(){n.stopped=!1},remove:function(){var e=o.indexOf(n);o.splice(e,1)},callback:e};return o.push(n),setTimeout(function(){e(r)},10),n};n.setSession=function(e){"function"==typeof e&&(e=e(r)),function(e){r=e,o.forEach(function(n){var t=n.stopped,o=n.callback;t||o(e)}),localStorage.setItem("_cmsState",JSON.stringify(e))}(t({},r,e))},n.schemaHelper={getSchema:function(e){return fetch("/api/schema/"+e+"/").then(function(e){return e.json()})},getAll:function(){return fetch("/api/schema/").then(function(e){return e.json()})}};var c=function(e){return console.log("handle user auth status",e),e&&e.token&&localStorage.setItem("currentUserToken",e.token),u(e.token),e};n.getToken=function(){var e=localStorage.getItem("currentUserToken");return u(e)};var u=function(e){var n={valid:!1};if(e&&e.length){var t=e.split("."),o=atob(t[0]),r=JSON.parse(o),i=atob(t[1]),c=JSON.parse(i);n={valid:c.exp>Date.now()/1e3,header:r,data:c,token:e}}return a(n),n},a=function(e){f!==e.valid&&(f=e.valid,s.map(function(n){return n(e)}))},s=[],l=!1,f=!1;n.onAuthenticationChanged=function(e){-1===s.indexOf(e)&&s.push(e),e(n.getToken()),l||(l=!0,setInterval(function(){n.hasValidToken()},36e5))},n.isAdmin=function(){return n.hasValidToken()},n.hasValidToken=function(){return n.getToken().valid},n.signInWithToken=function(e){return fetch("/api/signInWithToken/",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}).then(function(e){return e.json()}).then(c)}}(window)},function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o);const i=function(){return window.cmslink||t(1),window.cmslink};console.log("linking",window.cmslink);const c=i().createLink,u=i().getCurrentLink,a=(i().hasValidToken,i().onAuthenticationChanged,i().schemaHelper,i().sessionChanged);i().setSession,i().signInWithToken;var s,l=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];var i=Object.assign.apply(Object,[{}].concat(t));return r.a.createElement(e,i)},f=(s={},{setComponents:function(e){for(var n in e)s[n]=e[n]},getComponent:function(e,n){return l(s[e],n)},getValue:function(e){return s[e]},hasComponent:function(e){return e.type?!!s[e.type]:!!s[e]}}),p=function(e,n){window.currentEditorLink&&window.currentEditorLink(e,n)},d=function(e){window.currentEditorLink=e};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.forEach(function(n){b(e,n,t[n])})}return e}function b(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function m(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,n){return(v=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var O=function(e){function n(e,t){var o,r,i;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),r=this,i=g(n).call(this,e),(o=!i||"object"!==h(i)&&"function"!=typeof i?k(r):i).linked={},o.gotLinkData=o.gotLinkData.bind(k(k(o))),o.renderChildren=o.renderChildren.bind(k(k(o))),o.setupListener=o.setupListener.bind(k(k(o))),o.isChanged=o.isChanged.bind(k(k(o))),o.connect=o.connect.bind(k(k(o))),o.filterProperties=o.filterProperties.bind(k(k(o))),o.delete=o.delete.bind(k(k(o))),o.connect=o.connect.bind(k(k(o))),o.fakeSend=o.fakeSend.bind(k(k(o))),o.store=o.store.bind(k(k(o))),o.resumeLink=o.resumeLink.bind(k(k(o))),o.stopLink=o.stopLink.bind(k(k(o)));var c=e.id;return"string"==typeof t&&(c=t),c&&o.setupListener(c),o._stateListener=a(function(e){try{var n=o.sessionFilter?o.sessionFilter(e):y({},e);o.isChanged(o.sessionData,n)&&(o.sessionData=n,o._mounted&&o.forceUpdate())}catch(e){console.warn("set session failed",e)}}),o}var t,o,i;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&v(e,n)}(n,r.a.Component),t=n,(o=[{key:"gotLinkData",value:function(e){var n=this.filterProperties(e);this.isChanged(this.linked,n)&&(this.linked=n,this._mounted&&this.forceUpdate())}},{key:"renderChildren",value:function(){var e=this.linked.children;return(void 0===e?[]:e).filter(f.hasComponent).map(function(e){var n=e.id,t=e.type;return f.getComponent(t,{key:n,id:n})})}},{key:"setupListener",value:function(e,n){this._listener&&this._listener.remove(),this.linkedId=e,this.linked={},this._listener=u().listenTo(e,n||this.gotLinkData)}},{key:"isChanged",value:function(e,n){return function(e,n){return e!==n&&(void 0===e&&void 0!==n||void 0===n&&void 0!==e||JSON.stringify(e)!==JSON.stringify(n))}(e,n)}},{key:"connect",value:function(e){this.filterFunction=e}},{key:"filterProperties",value:function(e){return this.filterFunction?this.filterFunction(e):e}},{key:"delete",value:function(){var e=JSON.stringify({id:this.linkedId});u().send("-".concat(e))}},{key:"fakeSend",value:function(e){var n=this.linkedId;u().fakeNode(y({id:n},this.linked,e))}},{key:"store",value:function(e,n){var t=this.linkedId,o=n?e:y({id:t},e),r=JSON.stringify(o),i=n?"+":"=";u().send("".concat(i).concat(r))}},{key:"resumeLink",value:function(){this._mounted=!0,this._listener&&this._listener.resume(),this._stateListener&&this._stateListener.resume()}},{key:"stopLink",value:function(){this._mounted=!1,this._listener&&this._listener.stop(),this._stateListener&&this._stateListener.stop()}},{key:"componentDidMount",value:function(){this.resumeLink()}},{key:"componentWillUnmount",value:function(){this.stopLink()}}])&&m(t.prototype,o),i&&m(t,i),n}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.forEach(function(n){_(e,n,t[n])})}return e}function _(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function j(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,n){return!n||"object"!==w(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,n){return(L=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function P(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return{}},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return{}},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{children:!0};return function(i){function c(e){var r;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,c),(r=C(this,T(c).call(this,e))).sessionFilter=t,r.filterFunction=function(e){return o.children?S({},n(e),{children:e.children}):n(e)},r}var u,a,s;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&L(e,n)}(c,O),u=c,(a=[{key:"render",value:function(){var n=S({},this.sessionData,this.props,this.linked);return o.children&&(n.children=this.renderChildren()),r.a.createElement(e,n)}}])&&j(u.prototype,a),s&&j(u,s),c}()}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function I(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,n){return(D=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var J=r.a.createElement("svg",{style:{width:20,height:20},"aria-hidden":"true",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"},r.a.createElement("path",{fill:"currentColor",d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"})),A=r.a.createElement("svg",{style:{width:20,height:20},"aria-hidden":"true",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.a.createElement("path",{fill:"currentColor",d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"})),z=function(e){function n(e){var t,o,r;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),o=this,r=N(n).call(this,e),(t=!r||"object"!==E(r)&&"function"!=typeof r?M(o):r).connectionText="Connecting...",t.updateText=t.updateText.bind(M(M(t))),c({url:e.url},function(e){t.currentStatus=e,t.updateText(e),t._mounted&&t.forceUpdate()}),t}var t,o,i;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&D(e,n)}(n,r.a.Component),t=n,(o=[{key:"updateText",value:function(e){var n="Connecting...";e.connected?(n="Connected!",e.data&&(n+=" got data")):n="Disconnected!",e.reconnecting&&(n="Reconnecting..."),this.connectionText=n}},{key:"componentDidMount",value:function(){this._mounted=!0}},{key:"componentWillUnmount",value:function(){this._mounted=!1}},{key:"render",value:function(){var e=this.currentStatus,n=e.connected,t=e.reconnecting,o=e.connecting,i=n?J:A,c=t||o;return[].concat(x(this.props.children),[r.a.createElement("div",{key:"cmslink-status",className:"connection-status"},r.a.createElement("span",{className:"status-icon"+(c?" spinning":"")},i),r.a.createElement("span",null,this.connectionText))])}}])&&I(t.prototype,o),i&&I(t,i),n}();t.d(n,"renderMergedProps",function(){return l}),t.d(n,"componentRegistry",function(){return f}),t.d(n,"setEditComponent",function(){return p}),t.d(n,"setEditorLink",function(){return d}),t.d(n,"createLinkWrapper",function(){return P}),t.d(n,"LinkedComponent",function(){return O}),t.d(n,"CMSLink",function(){return z})}]);